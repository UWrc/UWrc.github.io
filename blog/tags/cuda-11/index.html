<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.66">
<title data-react-helmet="true">Posts tagged &quot;cuda11&quot; | HYAK</title><meta data-react-helmet="true" property="og:title" content="Posts tagged &quot;cuda11&quot; | HYAK"><meta data-react-helmet="true" name="description" content="Blog | Tagged &quot;cuda11&quot;"><meta data-react-helmet="true" property="og:description" content="Blog | Tagged &quot;cuda11&quot;"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/img/logos/uw_icon.png"><link rel="stylesheet" href="/styles.d5c213e0.css">
<link rel="preload" href="/styles.d5745864.js" as="script">
<link rel="preload" href="/runtime~main.97f079e5.js" as="script">
<link rel="preload" href="/main.b2f7d04e.js" as="script">
<link rel="preload" href="/1.43c761bd.js" as="script">
<link rel="preload" href="/2.9212d1f1.js" as="script">
<link rel="preload" href="/3.4c5ff17c.js" as="script">
<link rel="preload" href="/6875c492.bf3d4b64.js" as="script">
<link rel="preload" href="/e175ffcb.9d3e9757.js" as="script">
<link rel="preload" href="/ae1b97ef.89e1c608.js" as="script">
<link rel="preload" href="/516c1099.a0283cf9.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top" style="position:sticky"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logos/uw_icon.png" alt="HYAK Logo"><strong class="navbar__title">Research Computing</strong></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Home</a><a class="navbar__item navbar__link" href="/systems">Systems</a><a class="navbar__item navbar__link" href="/pricing">Pricing</a><a class="navbar__item navbar__link" href="/docs">Documentation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Stories</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link" href="/about">About</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/about">Supporting You</a></li><li><a class="dropdown__link" href="/team">Our Team</a></li><li><a class="dropdown__link" href="/board">Governance Board</a></li><li><a class="dropdown__link" href="/publications">Publications</a></li></ul></div><div class="splashLogo_UTEc"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logos/uw_icon.png" alt="HYAK Logo"><strong class="navbar__title">Research Computing</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/">Home</a></li><li class="menu__list-item"><a class="menu__link" href="/systems">Systems</a></li><li class="menu__list-item"><a class="menu__link" href="/pricing">Pricing</a></li><li class="menu__list-item"><a class="menu__link" href="/docs">Documentation</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">Stories</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" role="button" href="/about">About</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/about">Supporting You</a></li><li class="menu__list-item"><a class="menu__link" href="/team">Our Team</a></li><li class="menu__list-item"><a class="menu__link" href="/board">Governance Board</a></li><li class="menu__list-item"><a class="menu__link" href="/publications">Publications</a></li></ul></li></ul></div></div></div></nav><div class="scroll-notifier" style="visibility:hidden;width:100%"></div><div class="main-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--2"><div class="sidebar_3I7I"><h3 class="sidebarItemTitle_2Dv3">Recent posts</h3><ul class="sidebarItemList_1RlG"><li class="sidebarItem_Hxgp"><a class="sidebarItemLink_3ppv" href="/blog/2021/01/09/gromacs-gpu">gromacs on GPUs</a></li><li class="sidebarItem_Hxgp"><a class="sidebarItemLink_3ppv" href="/blog/2020/12/14/scrna-seq">scRNA-seq</a></li><li class="sidebarItem_Hxgp"><a class="sidebarItemLink_3ppv" href="/blog/2020/12/12/hello-world">Hello world!</a></li></ul></div></div><main class="col col--8"><h1>1 post tagged with &quot;cuda11&quot;</h1><a href="/blog/tags">View All Tags</a><div class="margin-vert--xl"><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_1mse"><a href="/blog/2021/01/09/gromacs-gpu">gromacs on GPUs</a></h2><div class="margin-vert--md"><time datetime="2021-01-09T00:00:00.000Z" class="blogPostDate_3bQP">January 9, 2021  Â· 6 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/npho" target="_blank" rel="noreferrer noopener"><img src="https://avatars3.githubusercontent.com/u/1252858?s=400&amp;v=4" alt="Nam Pho"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/npho" target="_blank" rel="noreferrer noopener">Nam Pho</a></h4><small class="avatar__subtitle">Director for Research Computing</small></div></div></header><section class="markdown"><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>During the January 12, 2021 mox maintenance period long overdue package updates will be applied. The most user impactful upgrade is the GPU driver from to 418.40.04 to 460.27.04 that will allow for CUDA 11 support (up from CUDA 10).</p></div></div><p>The second most widely used GPU-enabled workflow on HYAK (besides machine learning) is molecular dynamics (MD) so we wanted to test one of the most popular MD codes, gromacs [<a href="http://www.gromacs.org/About_Gromacs" target="_blank" rel="noopener noreferrer">source</a>], and ensure this driver upgrade wouldn&#x27;t negatively impact our researchers. I couldn&#x27;t find gromacs compiled with GPU support currently in our module collection so I used it as an opportunity to create one for you all, read on!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="using-gromacs"></a>Using gromacs<a aria-hidden="true" tabindex="-1" class="hash-link" href="#using-gromacs" title="Direct link to heading">#</a></h2><p>I&#x27;ll start with the end result for those of you who just want to use it but following that I&#x27;ll dive into the nuts and bolts of how we created the module so you can perform additional optimizations.</p><p>This is a GPU-enabled version of gromacs so we need a GPU first (can verify with <code>nvidia-smi</code>).</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">srun -p build-gpu --time</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token plain">:00:00 -n </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token plain"> --mem</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">20G --gpus</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> --pty </span><span class="token variable" style="color:rgb(191, 199, 213)">$0</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="gromacs-20204-module"></a>gromacs-2020.4 module<a aria-hidden="true" tabindex="-1" class="hash-link" href="#gromacs-20204-module" title="Direct link to heading">#</a></h3><p>Once we have a GPU we use modules to load gromacs-2020.4 and all its required dependencies (e.g., CUDA11).</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">module load gromacs/2020.4-cuda11.1</span></div></div></div></div></div><p>All packages are sub-commands of the <code>gmx</code> binary so you can verify the module.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><div tabindex="0" class="prism-code language-shell-session codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#bfc7d5;background-color:#292d3e"><div style="display:flex"><div style="width:12px;height:12px;margin-bottom:16px;border-radius:50%;background-color:#ff5f56;margin-left:0"></div><div style="width:12px;height:12px;margin-bottom:16px;border-radius:50%;background-color:#ffbd2e;margin-left:8px"></div><div style="width:12px;height:12px;margin-bottom:16px;border-radius:50%;background-color:#27c93f;margin-left:8px"></div></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ gmx -version</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        :-) GROMACS - gmx, 2020.4 (-:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">GROMACS version:    2020.4  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Verified release checksum is 79c2857291b034542c26e90512b92fd4b184a1c9d6fa59c55f2e24ccf14e7281</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Precision:          single  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Memory model:       64 bit  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">MPI library:        thread_mpi</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">OpenMP support:     enabled (GMX_OPENMP_MAX_THREADS = 64)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">GPU support:        CUDA</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">SIMD instructions:  AVX_512 </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">FFT library:        fftw-3.3.3-sse2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RDTSCP usage:       enabled </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">TNG support:        enabled </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Hwloc support:      hwloc-1.11.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Tracing support:    disabled</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">C compiler:         /sw/gcc/10.1.0/bin/gcc GNU 10.1.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">C compiler flags:   -mavx512f -mfma -fexcess-precision=fast -funroll-all-loops -O3 -DNDEBUG</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">C++ compiler:       /sw/gcc/10.1.0/bin/g++ GNU 10.1.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">C++ compiler flags: -mavx512f -mfma -fexcess-precision=fast -funroll-all-loops -fopenmp -O3 -DNDEBUG</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">CUDA compiler:      /sw/cuda/11.1.1-1/bin/nvcc nvcc: NVIDIA (R) Cuda compiler driver;Copyright (c) 2005-2020 NVIDIA Corporation;Built on Mon_Oct_12_20:09:46_PDT_2020;Cuda compilation tools, release 11.1, V11.1.105;Build cuda_11.1.TC455_06.29190527_0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">CUDA compiler flags:-gencode;arch=compute_35,code=sm_35;-gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_52,code=sm_52;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-Wno-deprecated-gpu-targets;-gencode;arch=compute_35,code=compute_35;-gencode;arch=compute_50,code=compute_50;-gencode;arch=compute_52,code=compute_52;-gencode;arch=compute_60,code=compute_60;-gencode;arch=compute_61,code=compute_61;-gencode;arch=compute_70,code=compute_70;-gencode;arch=compute_75,code=compute_75;-gencode;arch=compute_80,code=compute_80;-use_fast_math;;-mavx512f -mfma -fexcess-precision=fast -funroll-all-loops -fopenmp -O3 -DNDEBUG</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">CUDA driver:        11.20   </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">CUDA runtime:       11.10   </span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="test-simulation-of-lysozyme"></a>Test simulation of Lysozyme<a aria-hidden="true" tabindex="-1" class="hash-link" href="#test-simulation-of-lysozyme" title="Direct link to heading">#</a></h3><p>I used a tutorial from the gromacs website <a href="http://www.gromacs.org/@api/deki/files/198/=gmx-tutorial.pdf" target="_blank" rel="noopener noreferrer">here</a> to show it runs processes on GPU(s). The tutorial runs an MD simulation on a lysozyme but that&#x27;s the extent of my study there. The commands below are a summary of the tutorial with a note that the <code>genbox</code> subcommand is now replaced by <code>solvate</code>.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">gmx pdb2gmx -f 1LYD.pdb -water tip3p</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gmx editconf -f conf.gro -bt dodecahedron -d </span><span class="token number" style="color:rgb(247, 140, 108)">0.5</span><span class="token plain"> -o box.gro</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gmx solvate -cp box.gro -cs spc216.gro -p topol.top -o solvated.gro</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gmx trjconv -s solvated.gro -f solvated.gro -o solvated.pdb</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gmx grompp -f em.mdp -p topol.top -c solvated.gro -o em.tpr -maxwarn </span><span class="token number" style="color:rgb(247, 140, 108)">3</span></div></div></div></div></div><p>The final gromacs command below starts the fun, the documentation suggests it will automatically identify the GPUs available to send work to them. However, there are more explicit GPU arguments we encourage you to explore.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">gmx mdrun -v -deffnm em</span></div></div></div></div></div><p>You can <code>ssh</code> into the node you&#x27;re using in a separate window to have a parallel <code>nvidia-smi</code> command run so we can monitor the load on the GPU(s).</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><div tabindex="0" class="prism-code language-shell-session codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#bfc7d5;background-color:#292d3e"><div style="display:flex"><div style="width:12px;height:12px;margin-bottom:16px;border-radius:50%;background-color:#ff5f56;margin-left:0"></div><div style="width:12px;height:12px;margin-bottom:16px;border-radius:50%;background-color:#ffbd2e;margin-left:8px"></div><div style="width:12px;height:12px;margin-bottom:16px;border-radius:50%;background-color:#27c93f;margin-left:8px"></div></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+-------------------------------------------------------------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">| Processes:                                                        |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|  GPU   GI   CI        PID   Type   Process name        GPU Memory |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|        ID   ID                                         Usage      |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|===================================================================|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|    0   N/A  N/A    143353      C   gmx                     165MiB |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|    1   N/A  N/A    143353      C   gmx                     165MiB |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|    2   N/A  N/A    143353      C   gmx                     167MiB |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|    3   N/A  N/A    143353      C   gmx                     167MiB |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|    4   N/A  N/A    143353      C   gmx                     167MiB |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|    5   N/A  N/A    143353      C   gmx                     167MiB |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|    6   N/A  N/A    143353      C   gmx                     167MiB |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|    7   N/A  N/A    143353      C   gmx                     165MiB |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+-------------------------------------------------------------------+</span></div></div></div></div></div><p>We can see a process occuping each GPU so it works! At least, gromacs uses GPUs...the GPUs themselves weren&#x27;t stressed heavily and that requires the user to increase the number of rank processes and match that with available GPUs. You can do this by adding arguments to the <code>gmx mdrun</code> command but by default it did 2 ranks per GPU it detected, which is not a lot.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="optional-compile-notes"></a>(Optional) Compile Notes<a aria-hidden="true" tabindex="-1" class="hash-link" href="#optional-compile-notes" title="Direct link to heading">#</a></h2><p>You need CUDA11, GNU Compiler, and OpenBLAS library for the version I put together but I was focused on a proof-of-concept and not squeezing out every last drop of performance. There&#x27;s a lot of further optimization to be done and that&#x27;s left as an exercise for the reader:</p><ol><li>Try the Intel compiler and see if it provides further optimization for non-GPU parts of the workflow.</li><li>Try other math libraries (e.g., MKL) and see if it speeds things up.</li><li>Add in MPI support if you want to use multiple GPUs across multiple nodes.</li><li>Add in modules (e.g., PLUMED).</li><li>Other stuff I can&#x27;t think of with compile flags [<a href="https://manual.gromacs.org/documentation/2020/install-guide/index.html" target="_blank" rel="noopener noreferrer">here</a>].</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="download-source"></a>Download Source<a aria-hidden="true" tabindex="-1" class="hash-link" href="#download-source" title="Direct link to heading">#</a></h3><p>From the login node I staged a folder in the <a href="/docs/tools/modules">modules</a> directory.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> /sw/gromacs/2020.4-cuda11.1</span></div></div></div></div></div><p>Grab regression tests.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">wget</span><span class="token plain"> http://gerrit.gromacs.org/download/regressiontests-2020.4.tar.gz</span></div></div></div></div></div><p>Download gromacs-2020.4 [<a href="https://manual.gromacs.org/documentation/2020.4/download.html" target="_blank" rel="noopener noreferrer">source</a>].</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">wget</span><span class="token plain"> ftp://ftp.gromacs.org/pub/gromacs/gromacs-2020.4.tar.gz</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="get-a-gpu-and-code"></a>Get a GPU and Code<a aria-hidden="true" tabindex="-1" class="hash-link" href="#get-a-gpu-and-code" title="Direct link to heading">#</a></h3><p>I used the shared <code>build-gpu</code> node for an interactive session but if you are affiliated with a group that has their own you can use that instead.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">srun -p build-gpu --time</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token plain">:00:00 -n </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token plain"> --mem</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">20G --gpus</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> --pty </span><span class="token variable" style="color:rgb(191, 199, 213)">$0</span></div></div></div></div></div><p>Once you get a session with GPU (you can run <code>nvidia-smi</code> to confirm you see one). Extract regression tests.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">tar</span><span class="token plain"> xvzf regressiontests-2020.4.tar.gz</span></div></div></div></div></div><p>Do the same for the gromacs code and enter the directory.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">tar</span><span class="token plain"> xzvf gromacs-2020.4.tar.gz</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> gromacs-2020.4</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="pre-requisite-modules"></a>Pre-requisite Modules<a aria-hidden="true" tabindex="-1" class="hash-link" href="#pre-requisite-modules" title="Direct link to heading">#</a></h3><p>Modules loaded individually for readability but you could load all modules in one command. Get a refresher on modules <a href="/docs/tools/modules">here</a>.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">module load cmake/3.11.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">module load gcc/10.1.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">module load cuda/11.1.1-1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">module load contrib/openblas/0.2.20</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="compile"></a>Compile<a aria-hidden="true" tabindex="-1" class="hash-link" href="#compile" title="Direct link to heading">#</a></h3><p>I created a subdirectory within the source to compile.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">mkdir</span><span class="token plain"> cuda11</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> cuda11</span></div></div></div></div></div><p>Use <code>cmake</code> to create the <code>Makefile</code>. <strong>Note</strong>: if you copy-and-paste the <code>cmake</code> command below you <em>will</em> have to modify the paths referenced for your environment.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_3RXF"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1PCb">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cmake </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain"> -DGMX_BUILD_OWN_FFTW</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">OFF -DREGRESSIONTEST_DOWNLOAD</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">OFF -DGMX_GPU</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">ON -DGMX_MPI</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">OFF -DCMAKE_INSTALL_PREFIX</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">/sw/gromacs/2020.4-cuda11.1 -DREGRESSIONTEST_PATH</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">/sw/gromacs/2020.4-cuda11.1/regressiontests-2020.4 -DCUDA_TOOLKIT_ROOT_DIR</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">/sw/cuda/11.1.1-1</span></div></div></div></div></div><p>With the <code>Makefile</code> ready you can run <code>make -j 4</code> and replace 4 with however many cores you have in your session then <code>make install</code>. I created the module file separately so you can load it with <code>module load gromacs/2020.4-cuda11.1</code> and run the single <code>gmx</code> binary.</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/gromacs">gromacs</a><a class="margin-horiz--sm" href="/blog/tags/molecular-dynamics">molecular dynamics</a><a class="margin-horiz--sm" href="/blog/tags/md">md</a><a class="margin-horiz--sm" href="/blog/tags/gpu">gpu</a><a class="margin-horiz--sm" href="/blog/tags/cuda">cuda</a><a class="margin-horiz--sm" href="/blog/tags/cuda-11">cuda11</a></div><div class="col text--right"><a aria-label="Read more about gromacs on GPUs" href="/blog/2021/01/09/gromacs-gpu"><strong>Read More</strong></a></div></footer></article></div></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">HYAK</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/">Home</a></li><li class="footer__item"><a class="footer__link-item" href="/sign-up">Sign Up</a></li><li class="footer__item"><a class="footer__link-item" href="/docs">Documentation</a></li><li class="footer__item"><a class="footer__link-item" href="/about">About</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Sponsors</h4><ul class="footer__items"><li class="footer__item"><a href="https://artsci.washington.edu" target="_blank" rel="noopener noreferrer" class="footer__link-item">College of Arts &amp; Sciences</a></li><li class="footer__item"><a href="https://www.engr.washington.edu" target="_blank" rel="noopener noreferrer" class="footer__link-item">College of Engineering</a></li><li class="footer__item"><a href="https://environment.uw.edu" target="_blank" rel="noopener noreferrer" class="footer__link-item">College of the Environment</a></li><li class="footer__item"><a href="https://www.ipd.uw.edu" target="_blank" rel="noopener noreferrer" class="footer__link-item">Institute for Protein Design</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Contact</h4><ul class="footer__items"><li class="footer__item"><a href="mailto:help@uw.edu?subject=hyak help footer" target="_blank" rel="noopener noreferrer" class="footer__link-item">E-mail</a></li><li class="footer__item"><a href="https://mailman1.u.washington.edu/mailman/listinfo/hyak-users" target="_blank" rel="noopener noreferrer" class="footer__link-item">Mailing List</a></li><li class="footer__item"><a href="https://uw-hpcc.slack.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://github.com/uwrc" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li></ul></div></div><div class="text--center"><div>Made with â¤ï¸ in Seattle</div></div></div></footer></div>
<script src="/styles.d5745864.js"></script>
<script src="/runtime~main.97f079e5.js"></script>
<script src="/main.b2f7d04e.js"></script>
<script src="/1.43c761bd.js"></script>
<script src="/2.9212d1f1.js"></script>
<script src="/3.4c5ff17c.js"></script>
<script src="/6875c492.bf3d4b64.js"></script>
<script src="/e175ffcb.9d3e9757.js"></script>
<script src="/ae1b97ef.89e1c608.js"></script>
<script src="/516c1099.a0283cf9.js"></script>
</body>
</html>
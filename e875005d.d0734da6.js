(window.webpackJsonp=window.webpackJsonp||[]).push([[86],{153:function(e,a,n){"use strict";n.r(a),n.d(a,"frontMatter",(function(){return o})),n.d(a,"metadata",(function(){return c})),n.d(a,"toc",(function(){return s})),n.d(a,"default",(function(){return b}));var t=n(3),r=n(7),i=(n(0),n(170)),o={id:"r",title:"R and Rstudio"},c={unversionedId:"tools/r",id:"tools/r",isDocsHomePage:!1,title:"R and Rstudio",description:"R is a popular statistical programming language for data science and analytics. We rely on Singularity containers to deploy R and you can get a refresher on modules and containers.",source:"@site/docs/tools/r.md",slug:"/tools/r",permalink:"/docs/tools/r",version:"current",sidebar:"someSidebar",previous:{title:"Singularity and Docker",permalink:"/docs/tools/containers"},next:{title:"Python",permalink:"/docs/tools/python"}},s=[{value:"R",id:"r",children:[{value:"User Environment",id:"user-environment",children:[]},{value:"Base Container",id:"base-container",children:[]},{value:"Tidyverse Container",id:"tidyverse-container",children:[]},{value:"Module",id:"module",children:[]}]},{value:"Rstudio",id:"rstudio",children:[]}],l={toc:s};function b(e){var a=e.components,n=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(t.a)({},l,n,{components:a,mdxType:"MDXLayout"}),Object(i.b)("p",null,"R is a popular statistical programming language for data science and analytics. We rely on Singularity containers to deploy R and you can get a refresher on ",Object(i.b)("a",Object(t.a)({parentName:"p"},{href:"/docs/tools/modules"}),"modules")," and ",Object(i.b)("a",Object(t.a)({parentName:"p"},{href:"/docs/tools/containers"}),"containers"),"."),Object(i.b)("h2",{id:"r"},"R"),Object(i.b)("p",null,"We encourage users to employ the containerized versions of R instead of compiling from source and running bare-metal. We'll use Docker hub containers as that is where the most regular updates to R come from."),Object(i.b)("h3",{id:"user-environment"},"User Environment"),Object(i.b)("p",null,"If you use a non-custom R container you'll likely want to run ",Object(i.b)("inlineCode",{parentName:"p"},"install.packages()")," at some point. Usually on a non-shared platform like your local setup (where you have full administrative privileges) R will install things into central paths. You don't want to do that on HYAK so you need to specify user paths."),Object(i.b)("pre",null,Object(i.b)("code",Object(t.a)({parentName:"pre"},{className:"language-shell-session",metastring:"terminal=true",terminal:"true"}),'$ cat ~/.Renviron \nR_LIBS="/gscratch/scrubbed/npho/R/"\n$\n')),Object(i.b)("div",{className:"admonition admonition-caution alert alert--warning"},Object(i.b)("div",Object(t.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(t.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(t.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"}),Object(i.b)("path",Object(t.a)({parentName:"svg"},{fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"})))),"caution")),Object(i.b)("div",Object(t.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"If you plan on using multiple R versions you will want to set ",Object(i.b)("inlineCode",{parentName:"p"},"R_LIBS")," appropriately with each different container (i.e., R version) used so packages compiled against one version of R don't conflict with another. Using sub-folders with names matching that version of R is sufficient."))),Object(i.b)("p",null,"You can set custom R environment variables with the ",Object(i.b)("inlineCode",{parentName:"p"},".Renviron")," file. I set the ",Object(i.b)("inlineCode",{parentName:"p"},"R_LIBS"),' environment variable to point to a folder I created in "scrubbed" as an example but you will want to use a shared lab space or other path unique to your environment.'),Object(i.b)("div",{className:"admonition admonition-info alert alert--info"},Object(i.b)("div",Object(t.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(t.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(t.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(t.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"info")),Object(i.b)("div",Object(t.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"If you set ",Object(i.b)("inlineCode",{parentName:"p"},"R_LIBS")," to your home directory you can quickly run out of inodes as R likes to create a lot of files. Use your lab directory instead."))),Object(i.b)("h3",{id:"base-container"},"Base Container"),Object(i.b)("p",null,"Let's say we wanted to use R-4.0.3 from Docker hub\n[",Object(i.b)("a",Object(t.a)({parentName:"p"},{href:"https://hub.docker.com/_/r-base?tab=tags&page=1&ordering=last_updated"}),"www"),"]."),Object(i.b)("pre",null,Object(i.b)("code",Object(t.a)({parentName:"pre"},{className:"language-bash"}),"singularity pull docker://r-base:4.0.3\n")),Object(i.b)("p",null,"Be sure to do this from a build node, you need to be routed to the internet to resolve Dockerhub so you can download and have compute resources to do the image conversion from a Docker to Singularity container."),Object(i.b)("pre",null,Object(i.b)("code",Object(t.a)({parentName:"pre"},{className:"language-shell-session",metastring:"terminal=true",terminal:"true"}),"$ module load singularity\n$ singularity pull docker://r-base:4.0.3\nINFO:    Converting OCI blobs to SIF format\nINFO:    Starting build...\nGetting image source signatures\nSkipping fetch of repeat blob sha256:ecd924c7226f314c16de965258f37da4aa990c07e494be1116af512706138401\nSkipping fetch of repeat blob sha256:4fec22ce03e6be2d27efb3e9a90be68b14183859abf0864518e2581aa49fb8f5\nSkipping fetch of repeat blob sha256:69d900227a8f4d4d2647927b9fa8da77f0f535ca497bc771c5f8a72b0cc971df\nSkipping fetch of repeat blob sha256:45c9ad96a035ae2a5bda28a6e666ed7e1bbe5d945180faafd1c2ed611473e728\nSkipping fetch of repeat blob sha256:f6f2416c67056dd5c3a5948858ab4578631e13cc36ee43bd8d44dea4ec4693f7\nSkipping fetch of repeat blob sha256:0079bdf52f600362737f2c00e7e7ae11458844ef1d06265caf24115be990c4ab\nCopying config sha256:729e7d1e2a8b59f2e885f4c7586be463050a70c00cc06bdef306e93a5bf88922\n 4.11 KiB / 4.11 KiB [======================================================] 0s\nWriting manifest to image destination\nStoring signatures\n2021/01/10 11:41:34  info unpack layer: sha256:ecd924c7226f314c16de965258f37da4aa990c07e494be1116af512706138401\n2021/01/10 11:41:37  info unpack layer: sha256:4fec22ce03e6be2d27efb3e9a90be68b14183859abf0864518e2581aa49fb8f5\n2021/01/10 11:41:37  info unpack layer: sha256:69d900227a8f4d4d2647927b9fa8da77f0f535ca497bc771c5f8a72b0cc971df\n2021/01/10 11:41:38  info unpack layer: sha256:45c9ad96a035ae2a5bda28a6e666ed7e1bbe5d945180faafd1c2ed611473e728\n2021/01/10 11:41:38  info unpack layer: sha256:f6f2416c67056dd5c3a5948858ab4578631e13cc36ee43bd8d44dea4ec4693f7\n2021/01/10 11:41:38  info unpack layer: sha256:0079bdf52f600362737f2c00e7e7ae11458844ef1d06265caf24115be990c4ab\nINFO:    Creating SIF file...\nINFO:    Build complete: r-base_4.0.3.sif\n$\n")),Object(i.b)("p",null,"The command will take a minute and create the SIF file in your current directory."),Object(i.b)("pre",null,Object(i.b)("code",Object(t.a)({parentName:"pre"},{className:"language-shell-session",metastring:"terminal=true",terminal:"true"}),"$ ls -alh r-base_4.0.3.sif \n474M r-base_4.0.3.sif\n$\n")),Object(i.b)("p",null,"You can run the R binary within the container like below."),Object(i.b)("pre",null,Object(i.b)("code",Object(t.a)({parentName:"pre"},{className:"language-shell-session",metastring:"terminal=true",terminal:"true"}),'$ singularity run r-base_4.0.3.sif R\n\nR version 4.0.3 (2020-10-10) -- "Bunny-Wunnies Freak Out"\nCopyright (C) 2020 The R Foundation for Statistical Computing\nPlatform: x86_64-pc-linux-gnu (64-bit)\n\n> library(tidyverse)\nError in library(tidyverse) : there is no package called \u2018tidyverse\u2019\n> \n')),Object(i.b)("p",null,"You can run ",Object(i.b)("inlineCode",{parentName:"p"},"install.packages()")," as you normally would if you were working with R locally and it will install all the files to whatever path you set ",Object(i.b)("inlineCode",{parentName:"p"},"R_LIBS")," to in the ",Object(i.b)("a",Object(t.a)({parentName:"p"},{href:"#user-environment"}),"user environment")," instructions."),Object(i.b)("h3",{id:"tidyverse-container"},"Tidyverse Container"),Object(i.b)("p",null,"The most popular library for R is the Tidyverse [",Object(i.b)("a",Object(t.a)({parentName:"p"},{href:"https://www.tidyverse.org"}),"www"),"], which includes packages like ",Object(i.b)("inlineCode",{parentName:"p"},"ggplot2"),", ",Object(i.b)("inlineCode",{parentName:"p"},"dplyr"),", and others. As you can see in the ",Object(i.b)("a",Object(t.a)({parentName:"p"},{href:"#base-container"}),"previous section"),", it doesn't exist if we use the ",Object(i.b)("inlineCode",{parentName:"p"},"r-base")," Docker hub container."),Object(i.b)("p",null,"Your options are to: "),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"run ",Object(i.b)("inlineCode",{parentName:"li"},'install.packages("tidyverse")')," or"),Object(i.b)("li",{parentName:"ol"},"use a Docker container with it pre-installed.")),Object(i.b)("p",null,"Option 1, while ok, uses a lot (and I mean a lot) of inodes as well as taking a long time to compile. It's much leaner on the cluster and faster to use a pre-built container if you know you'll use the Tidyverse."),Object(i.b)("p",null,"The Rocker Project [",Object(i.b)("a",Object(t.a)({parentName:"p"},{href:"https://www.rocker-project.org"}),"www"),"] manages popular Docker containers for R, including a pre-built one with Tidyverse so you can grab the latest tagged container from Docker hub [",Object(i.b)("a",Object(t.a)({parentName:"p"},{href:"https://hub.docker.com/r/rocker/tidyverse/tags?page=1&ordering=last_updated"}),"www"),"]."),Object(i.b)("pre",null,Object(i.b)("code",Object(t.a)({parentName:"pre"},{className:"language-bash"}),"singularity pull docker://rocker/tidyverse:4.0.1\n")),Object(i.b)("p",null,"Prior instructions on R ",Object(i.b)("a",Object(t.a)({parentName:"p"},{href:"#user-environment"}),"user environment")," apply but once downloaded (the Docker to Singularity conversion will take a few minutes), it will create a separate SIF file as shown below."),Object(i.b)("pre",null,Object(i.b)("code",Object(t.a)({parentName:"pre"},{className:"language-shell-session",metastring:"terminal=true",terminal:"true"}),"$ singularity pull docker://rocker/tidyverse:4.0.1\nINFO:    Converting OCI blobs to SIF format\nINFO:    Starting build...\nGetting image source signatures\nSkipping fetch of repeat blob sha256:a4a2a29f9ba48efd3d2075f395538b2eec56fb1bedfb7aecf5e54174446f9e2a\nSkipping fetch of repeat blob sha256:127c9761dcbaa288abc58fc56437c2f2ffbe611b9f7f30e0b5b43cd348bb2094\nSkipping fetch of repeat blob sha256:d13bf203e905463e64d89b14509aafa983fb8baf7c1931fe0a65652aeb6c838f\nSkipping fetch of repeat blob sha256:4039240d2e0b4bcb42ccbce75bc54570e471ad81457478de35fbeef63536e9c0\nCopying blob sha256:0ccb9f239bc673ecea30ef11ce2c495bbb85abdd96d675d44f60324c7c45d387\n 20.56 KiB / 20.56 KiB [====================================================] 0s\nCopying blob sha256:c01d69634a9de92ab364afa9d6da377ba923131a4e170c3983a9243acafb0879\n 278.52 MiB / 278.52 MiB [=================================================] 11s\nCopying blob sha256:d6e983dd45f0e15594336e5aabbcd004fbbb7efd8355ebd5e07f916837659fd6\n 225.42 MiB / 225.42 MiB [==================================================] 9s\nCopying blob sha256:0d19f4c62fe952f2cec37dbde49decc2a787df40d87eecd7a8a657c04335c20b\n 190.84 KiB / 190.84 KiB [==================================================] 0s\nCopying blob sha256:c4186f33a14ce3205196906179b6d17db22a3e9dfc9f34fedbb1f38bf2e715c9\n 190.39 MiB / 190.39 MiB [==================================================] 7s\nCopying config sha256:22b3bdc99b5be46467e695d3639022d344d0fc4daf239a6da1f6b478ed1ee695\n 6.38 KiB / 6.38 KiB [======================================================] 0s\nWriting manifest to image destination\nStoring signatures\n2021/01/10 12:28:57  info unpack layer: sha256:a4a2a29f9ba48efd3d2075f395538b2eec56fb1bedfb7aecf5e54174446f9e2a\n2021/01/10 12:28:59  info unpack layer: sha256:127c9761dcbaa288abc58fc56437c2f2ffbe611b9f7f30e0b5b43cd348bb2094\n2021/01/10 12:28:59  info unpack layer: sha256:d13bf203e905463e64d89b14509aafa983fb8baf7c1931fe0a65652aeb6c838f\n2021/01/10 12:28:59  info unpack layer: sha256:4039240d2e0b4bcb42ccbce75bc54570e471ad81457478de35fbeef63536e9c0\n2021/01/10 12:28:59  info unpack layer: sha256:0ccb9f239bc673ecea30ef11ce2c495bbb85abdd96d675d44f60324c7c45d387\n2021/01/10 12:28:59  info unpack layer: sha256:c01d69634a9de92ab364afa9d6da377ba923131a4e170c3983a9243acafb0879\n2021/01/10 12:29:10  info unpack layer: sha256:d6e983dd45f0e15594336e5aabbcd004fbbb7efd8355ebd5e07f916837659fd6\n2021/01/10 12:29:22  info unpack layer: sha256:0d19f4c62fe952f2cec37dbde49decc2a787df40d87eecd7a8a657c04335c20b\n2021/01/10 12:29:22  info unpack layer: sha256:c4186f33a14ce3205196906179b6d17db22a3e9dfc9f34fedbb1f38bf2e715c9\nINFO:    Creating SIF file...\nINFO:    Build complete: tidyverse_4.0.1.sif\n$ ls -alh tidyverse_4.0.1.sif\n675M tidyverse_4.0.1.sif\n$\n")),Object(i.b)("p",null,"Now when you run this container's R binary you can successfully load the Tidyverse."),Object(i.b)("pre",null,Object(i.b)("code",Object(t.a)({parentName:"pre"},{className:"language-shell-session",metastring:"terminal=true",terminal:"true"}),'$ singularity run tidyverse_4.0.1.sif R\n\nR version 4.0.1 (2020-06-06) -- "See Things Now"\nCopyright (C) 2020 The R Foundation for Statistical Computing\nPlatform: x86_64-pc-linux-gnu (64-bit)\n\n> library(tidyverse)\n\u2500\u2500 Attaching packages \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 tidyverse 1.3.0 \u2500\u2500\n\u2714 ggplot2 3.3.2     \u2714 purrr   0.3.4\n\u2714 tibble  3.0.1     \u2714 dplyr   1.0.0\n\u2714 tidyr   1.1.0     \u2714 stringr 1.4.0\n\u2714 readr   1.3.1     \u2714 forcats 0.5.0\n\u2500\u2500 Conflicts \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 tidyverse_conflicts() \u2500\u2500\n\u2716 dplyr::filter() masks stats::filter()\n\u2716 dplyr::lag()    masks stats::lag()\nWarning messages:\n1: replacing previous import \u2018vctrs::data_frame\u2019 by \u2018tibble::data_frame\u2019 when loading \u2018dplyr\u2019 \n2: package \u2018purrr\u2019 was built under R version 4.0.3 \n> \n')),Object(i.b)("p",null,"Success!"),Object(i.b)("h3",{id:"module"},"Module"),Object(i.b)("p",null,"We've since migrated from bare-metal R binaries compiled from source and provided as a module to leveraging containers. However, there are still some version 3 variants of R still available."),Object(i.b)("pre",null,Object(i.b)("code",Object(t.a)({parentName:"pre"},{className:"language-shell-session",metastring:"terminal=true",terminal:"true"}),"$ module avail r_3 contrib/r/\n----- /sw/modules-1.775/modulefiles -----\nr_3.3.3  r_3.5.1  r_3.6.0  r_3.6.0+Rmpi-impi_2019  \n----- /sw/modules-1.775/modulefiles -----\ncontrib/r/3.4.3  contrib/r/3.5.1  contrib/r/3.6.1 \n")),Object(i.b)("p",null,'As a reminder all "contrib" prefixed modules are user community created and maintained (i.e., not supported by the HYAK team).'),Object(i.b)("h2",{id:"rstudio"},"Rstudio"),Object(i.b)("p",null,"Rstudio is an integrated development environment (IDE) for R. It's a front-end interface, historically a desktop application but it will be delivered through your browser in this instance."),Object(i.b)("p",null,"Rstudio will run in a Singularity container on a compute node then be directed through the login node back to your local computer via port forwarding."),Object(i.b)("p",null,"TODO"))}b.isMDXComponent=!0},170:function(e,a,n){"use strict";n.d(a,"a",(function(){return d})),n.d(a,"b",(function(){return f}));var t=n(0),r=n.n(t);function i(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function o(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);a&&(t=t.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,t)}return n}function c(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?o(Object(n),!0).forEach((function(a){i(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function s(e,a){if(null==e)return{};var n,t,r=function(e,a){if(null==e)return{};var n,t,r={},i=Object.keys(e);for(t=0;t<i.length;t++)n=i[t],a.indexOf(n)>=0||(r[n]=e[n]);return r}(e,a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)n=i[t],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=r.a.createContext({}),b=function(e){var a=r.a.useContext(l),n=a;return e&&(n="function"==typeof e?e(a):c(c({},a),e)),n},d=function(e){var a=b(e.components);return r.a.createElement(l.Provider,{value:a},e.children)},u={inlineCode:"code",wrapper:function(e){var a=e.children;return r.a.createElement(r.a.Fragment,{},a)}},p=r.a.forwardRef((function(e,a){var n=e.components,t=e.mdxType,i=e.originalType,o=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),d=b(n),p=t,f=d["".concat(o,".").concat(p)]||d[p]||u[p]||i;return n?r.a.createElement(f,c(c({ref:a},l),{},{components:n})):r.a.createElement(f,c({ref:a},l))}));function f(e,a){var n=arguments,t=a&&a.mdxType;if("string"==typeof e||t){var i=n.length,o=new Array(i);o[0]=p;var c={};for(var s in a)hasOwnProperty.call(a,s)&&(c[s]=a[s]);c.originalType=e,c.mdxType="string"==typeof e?e:t,o[1]=c;for(var l=2;l<i;l++)o[l]=n[l];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,n)}p.displayName="MDXCreateElement"}}]);
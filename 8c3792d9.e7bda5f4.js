(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{128:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return l})),n.d(t,"metadata",(function(){return c})),n.d(t,"toc",(function(){return s})),n.d(t,"default",(function(){return b}));var o=n(3),a=n(7),r=(n(0),n(174)),i=["components"],l={id:"containers",title:"Singularity and Docker"},c={unversionedId:"tools/containers",id:"tools/containers",isDocsHomePage:!1,title:"Singularity and Docker",description:"[sylabs]: /img/docs/sylabs-cloud.png 'Sylabs Cloud'",source:"@site/docs/tools/containers.md",slug:"/tools/containers",permalink:"/docs/tools/containers",version:"current",sidebar:"someSidebar",previous:{title:"Compilers",permalink:"/docs/tools/compilers"},next:{title:"R and Rstudio",permalink:"/docs/tools/r"}},s=[{value:"Singularity",id:"singularity",children:[{value:"Ubuntu <code>apt-get</code> Example",id:"ubuntu-apt-get-example",children:[]}]},{value:"App Stores",id:"app-stores",children:[{value:"Sylabs.io Cloud Library",id:"sylabsio-cloud-library",children:[]},{value:"Docker Hub",id:"docker-hub",children:[]},{value:"Biocontainers.pro",id:"biocontainerspro",children:[]},{value:"NVIDIA GPU Cloud (NGC)",id:"nvidia-gpu-cloud-ngc",children:[]},{value:"NGC API Keys",id:"ngc-api-keys",children:[]}]}],u={toc:s};function b(e){var t=e.components,n=Object(a.a)(e,i);return Object(r.b)("wrapper",Object(o.a)({},u,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"Have you ever found yourself saying:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"I don't want to use HYAK because I can't install whatever I want? I found this command online and I can't setup the random \"program\" package with ",Object(r.b)("inlineCode",{parentName:"p"},"sudo apt-get install program"),"? Hate HYAK because you somehow want to use Ubuntu?")),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"I'm trying to work on my local computer then move it to HYAK and resume without friction? How about you set up something and now want to share that ",Object(r.b)("em",{parentName:"p"},"exact")," compute environment with a collaborator (or vice-versa)?"))),Object(r.b)("p",null,"The answer to either (or both) of those things are containers! Software containers are a way to package everything you need into a file to send around and have it work exactly the same across environments. The most popular containerization format is ",Object(r.b)("a",{parentName:"p",href:"#docker"},"Docker")," but that does require administrative access to run natively, so for shared platforms (e.g., HPC clusters like HYAK) an alternative called ",Object(r.b)("a",{parentName:"p",href:"#singularity"},"Singularity")," was developed. Almost every Docker container can be seamlessly converted to Singularity so they're effectively interchangable."),Object(r.b)("p",null,"What are the costs, trade offs, or downsides? You might imagine performance or that containerized applications run slower than native ones. This is not always true, in most instances they are near equivalent."),Object(r.b)("h2",{id:"singularity"},"Singularity"),Object(r.b)("p",null,"The official Singularity documentation [",Object(r.b)("a",{parentName:"p",href:"https://sylabs.io/guides/3.7/user-guide/"},"www"),"] is the best source."),Object(r.b)("h3",{id:"ubuntu-apt-get-example"},"Ubuntu ",Object(r.b)("inlineCode",{parentName:"h3"},"apt-get")," Example"),Object(r.b)("p",null,"Let's say that you want to use ",Object(r.b)("inlineCode",{parentName:"p"},"git")," and the current version of ",Object(r.b)("inlineCode",{parentName:"p"},"git")," on HYAK is 1.8.3.1 as shown below."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-shell-session",metastring:"terminal=true",terminal:"true"},"$ which git \n/usr/bin/git\n$ git --version\ngit version 1.8.3.1\n$ \n")),Object(r.b)("p",null,"Let's say you want a newer version AND you also want it running on Ubuntu for some reason. Here we'll walk you through installing the latest ",Object(r.b)("inlineCode",{parentName:"p"},"git")," binary using ",Object(r.b)("inlineCode",{parentName:"p"},"apt")," repositories for Ubuntu 16.04 [",Object(r.b)("a",{parentName:"p",href:"https://releases.ubuntu.com/16.04/"},"www"),'] or "Xenial Xerus".'),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"Get an interactive session using some variant of the below command.")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"srun -A mygroup -p compute --time=1:00:00 -n 2 --mem=10G --pty $0\n")),Object(r.b)("ol",{start:2},Object(r.b)("li",{parentName:"ol"},"Load the Singularity module.")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"module load singularity\n")),Object(r.b)("ol",{start:3},Object(r.b)("li",{parentName:"ol"},"Create a Singularity definition file. Mine is below called ",Object(r.b)("inlineCode",{parentName:"li"},"tools.def")," to install the latest ",Object(r.b)("inlineCode",{parentName:"li"},"curl")," and ",Object(r.b)("inlineCode",{parentName:"li"},"git")," binaries from the Ubuntu repositories.")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-dockerfile"},"Bootstrap: docker\nFrom: ubuntu:16.04\n%post\n    apt -y update\n    apt -y install curl git\n\n")),Object(r.b)("ol",{start:4},Object(r.b)("li",{parentName:"ol"},"Built a Singularity container from its definition file. The generated SIF file is your portable container. Note the definition file should be executable or you can switch the reference to file to ",Object(r.b)("inlineCode",{parentName:"li"},"./tools.def")," if you're in the same working directory or provide the absolute path.")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"singularity build --fakeroot tools.sif tools.def\n")),Object(r.b)("ol",{start:5},Object(r.b)("li",{parentName:"ol"},"Run the binary.")),Object(r.b)("p",null,"You'll do this through the ",Object(r.b)("inlineCode",{parentName:"p"},"singularity")," executable to distinguish it from the ",Object(r.b)("inlineCode",{parentName:"p"},"git")," binary in the main operation system."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-shell-session",metastring:"terminal=true",terminal:"true"},"$ singularity exec tools.sif git --version            \ngit version 2.7.4\n$ \n")),Object(r.b)("p",null,"Notice the ",Object(r.b)("inlineCode",{parentName:"p"},"git")," version here is newer than the original we started with. Success!"),Object(r.b)("h2",{id:"app-stores"},"App Stores"),Object(r.b)("p",null,"If you followed the tutorial above you should be able to install anything you want but why re-create the wheel? There is a large developer community out there that maintains a majority of the most common scientific applications."),Object(r.b)("h3",{id:"sylabsio-cloud-library"},"Sylabs.io Cloud Library"),Object(r.b)("p",null,Object(r.b)("img",{parentName:"p",src:"/img/docs/sylabs-cloud.png",alt:"sylabs",title:"Sylabs Cloud"})),Object(r.b)("p",null,"The largest collection of native Singularity containers can be found at the Sylabs.io Cloud Container Library [",Object(r.b)("a",{parentName:"p",href:"https://cloud.sylabs.io/library"},"www"),"]. This would be the ideal first place to look for containers built by others since it is maintained by the creators of Singularity and provides the native container format."),Object(r.b)("h3",{id:"docker-hub"},"Docker Hub"),Object(r.b)("p",null,Object(r.b)("img",{parentName:"p",src:"/img/docs/docker-hub.png",alt:"docker-hub",title:"Docker Hub"})),Object(r.b)("p",null,"The biggest collection of Docker images is from Docker Hub [",Object(r.b)("a",{parentName:"p",href:"https://hub.docker.com"},"www"),"]."),Object(r.b)("p",null,"Let's say Docker Hub tells you the pull command for the container you want is ",Object(r.b)("inlineCode",{parentName:"p"},"docker pull gcc:11.1.0-bullseye"),". To have Singularity grab this Docker container and convert it to a Singularity container you'd modify the command to be ",Object(r.b)("inlineCode",{parentName:"p"},"singularity pull docker://gcc:11.1.0-bullseye"),"."),Object(r.b)("h3",{id:"biocontainerspro"},"Biocontainers.pro"),Object(r.b)("p",null,Object(r.b)("img",{parentName:"p",src:"/img/docs/biocontainer.png",alt:"biocontainer",title:"biocontainer"})),Object(r.b)("p",null,"A bioinformatics focused set of Singularity containers can be found at the Biocontainers.pro registry [",Object(r.b)("a",{parentName:"p",href:"https://biocontainers.pro/registry"},"www"),"]. It is a collection of (convertible to Singularity) Docker containers as well as native Singularity containers."),Object(r.b)("h3",{id:"nvidia-gpu-cloud-ngc"},"NVIDIA GPU Cloud (NGC)"),Object(r.b)("p",null,Object(r.b)("img",{parentName:"p",src:"/img/docs/ngc-catalog.png",alt:"ngc",title:"NGC"})),Object(r.b)("p",null,"A container registry that specializes in common GPU accelerated applications or GPU software development tools is provided by NVIDIA called the NVIDIA GPU Cloud (NGC) [",Object(r.b)("a",{parentName:"p",href:"https://ngc.nvidia.com/catalog/containers"},"www"),"]. For example, you might want to use a PyTorch container optimized for NVIDIA GPUs as seen below."),Object(r.b)("p",null,Object(r.b)("img",{parentName:"p",src:"/img/docs/ngc-pytorch.png",alt:"ngc-pytorch",title:"NGC Pytorch"})),Object(r.b)("p",null,"Depending on the NGC container, it might have directions on the exact pull command for Singularity. If it does not work be sure to prepend their pull location with ",Object(r.b)("inlineCode",{parentName:"p"},"docker://")," since these are native Docker containers that need to be converted to Singularity."),Object(r.b)("p",null,"The example above provides a Docker pull command for PyTorch but in this case you'd modify it similarly as if you got it from Docker Hub from ",Object(r.b)("inlineCode",{parentName:"p"},"docker pull nvcr.io/nvidia/pytorch:21.05-py3")," to ",Object(r.b)("inlineCode",{parentName:"p"},"singularity pull docker://nvcr.io/nvidia/pytorch:21.05-py3"),"."),Object(r.b)("h3",{id:"ngc-api-keys"},"NGC API Keys"),Object(r.b)("p",null,'In rare occasions a container in the NGC app store is going to require that you have an API. This is the only reason you\'d need to register for a user account with NGC. Once you have an NGC account and are logged in, at the top right the pull down menu select "Setup" and there\'s an option to "Get API Key". Save that string of text.'),Object(r.b)("p",null,"You only have to register your API key once but load the ngc module (i.e., ",Object(r.b)("inlineCode",{parentName:"p"},"module load ngc"),") and run ",Object(r.b)("inlineCode",{parentName:"p"},"ngc config set"),' which will prompt you for your API key. It\'s fine to select "ascii" as an option. Your API key will be stored under a ',Object(r.b)("inlineCode",{parentName:"p"},".ngc/config")," file in your home directory."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-shell-session",metastring:"terminal=true",terminal:"true"},"$ ngc config current\n+-------------+----------------------------------------------------------+--------------------+\n| key         | value                                                    | source             |\n+-------------+----------------------------------------------------------+--------------------+\n| apikey      | ******************************************************** | user settings file |\n|             | ************************YTc3                             |                    |\n| format_type | ascii                                                    | user settings file |\n+-------------+----------------------------------------------------------+--------------------+\n$\n")))}b.isMDXComponent=!0},174:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return m}));var o=n(0),a=n.n(o);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=a.a.createContext({}),u=function(e){var t=a.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},b=function(e){var t=u(e.components);return a.a.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},d=a.a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,i=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),b=u(n),d=o,m=b["".concat(i,".").concat(d)]||b[d]||p[d]||r;return n?a.a.createElement(m,l(l({ref:t},s),{},{components:n})):a.a.createElement(m,l({ref:t},s))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=d;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var s=2;s<r;s++)i[s]=n[s];return a.a.createElement.apply(null,i)}return a.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);